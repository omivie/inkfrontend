<!DOCTYPE html>
<html lang="en-NZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Manage your account settings">
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/svg+xml" href="/assets/icons/favicon.svg">
    <title>Account Settings | InkCartridges.co.nz</title>
    <!-- Google Analytics 4 (with consent mode) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SDQELG0FGD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('consent', 'default', {
            analytics_storage: localStorage.getItem('cookie_consent') === 'accepted' ? 'granted' : 'denied'
        });
        gtag('js', new Date());
        gtag('config', 'G-SDQELG0FGD');
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/modern-effects.css">
    <link rel="stylesheet" href="/css/pages.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <header class="site-header">
        <div class="header-main">
            <div class="container">
                <div class="header-contact">
                    <a href="tel:0800465275" class="header-contact__item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                        0800 INK KART (465 275)
                    </a>
                    <a href="mailto:support@inkcartridges.co.nz" class="header-contact__item">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                        support@inkcartridges.co.nz
                    </a>
                </div>
                <div class="logo-block">
                    <a href="/html/index.html" class="logo" aria-label="InkCartridges.co.nz Home">
                        <span class="logo__text">Ink<span>Cartridges</span>.co.nz</span>
                    </a>
                    <a href="/html/index.html" class="logo__tagline">Get the full picture on image quality</a>
                </div>
                <div class="header-actions">
                    <a href="/html/account/index.html" class="header-actions__item">
                        <span class="header-actions__icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
                        <span>Account</span>
                    </a>
                    <a href="/html/account/favourites.html" class="header-actions__item">
                        <span class="header-actions__icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></span>
                        <span>Favourites</span>
                    </a>
                    <a href="/html/cart.html" class="header-actions__item">
                        <span class="header-actions__icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>
                            <span class="cart-badge" id="cart-count">0</span>
                        </span>
                        <span>Cart</span>
                    </a>
                </div>
            </div>
        </div>
        <!-- Primary navigation -->
        <nav class="primary-nav" aria-label="Main navigation">
            <div class="container">
                <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                    <span class="visually-hidden">Menu</span>
                </button>

                <ul id="nav-menu" class="nav-menu">
                    <li class="nav-menu__item">
                        <a href="/html/index.html" class="nav-menu__link">Home</a>
                    </li>
                    <li class="nav-menu__item">
                        <a href="/html/shop.html" class="nav-menu__link">Shop</a>
                    </li>
                    <li class="nav-menu__item nav-menu__item--mega">
                        <button class="nav-menu__link nav-mega-toggle" type="button"
                                aria-haspopup="true" aria-expanded="false" aria-controls="brands-mega">
                            Ink Cartridge Brands
                            <svg class="nav-menu__arrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
                        </button>
                    </li>
                    <li class="nav-menu__item">
                        <a href="/html/ribbons.html" class="nav-menu__link">Typewriter &amp; Printer Ribbons</a>
                    </li>
                </ul>

                <!-- Search bar -->
                <form class="search-form search-form--nav" action="/html/shop.html" method="GET" role="search">
                    <label for="search-input" class="visually-hidden">Search for products</label>
                    <input
                        type="search"
                        id="search-input"
                        name="q"
                        class="search-form__input"
                        placeholder="Search..."
                        autocomplete="off"
                        maxlength="200"
                    >
                    <button type="submit" class="search-form__button" aria-label="Search">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                    </button>
                </form>
            </div>
        </nav>

        <!-- Brands Mega Dropdown -->
        <div class="brands-mega" id="brands-mega" hidden role="region" aria-label="Browse brands">
            <div class="container">
                <div class="brands-mega__cards"></div>
                <a href="/html/shop.html" class="brands-mega__view-all">
                    View All Brands
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
                </a>
            </div>
        </div>
    </header>
    <main id="main-content" class="site-main">
        <nav class="breadcrumb" aria-label="Breadcrumb">
            <div class="container">
                <ol class="breadcrumb__list">
                    <li class="breadcrumb__item"><a href="/html/index.html">Home</a></li>
                    <li class="breadcrumb__item"><a href="/html/account/index.html">My Account</a></li>
                    <li class="breadcrumb__item breadcrumb__item--current" aria-current="page">Account Settings</li>
                </ol>
            </div>
        </nav>
        <section class="account-page">
            <div class="container">
                <div class="account-layout">
    <aside class="account-sidebar">
        <div class="account-sidebar__user">
            <div class="account-sidebar__avatar">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
            </div>
            <div class="account-sidebar__details">
                <span class="account-sidebar__name" id="user-name"></span>
                <span class="account-sidebar__email" id="user-email"></span>
            </div>
        </div>
        <nav class="account-nav" aria-label="Account navigation">
            <ul class="account-nav__list">
                <li class="account-nav__divider" aria-hidden="true">Account</li>
                <li class="account-nav__item">
                    <a href="/html/account/index.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                        Dashboard
                    </a>
                </li>
                <li class="account-nav__item account-nav__item--active">
                    <a href="/html/account/settings.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                        Settings
                    </a>
                </li>
                <li class="account-nav__item">
                    <a href="/html/account/addresses.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
                        Addresses
                    </a>
                </li>
                <li class="account-nav__divider" aria-hidden="true">Orders</li>
                <li class="account-nav__item">
                    <a href="/html/account/orders.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
                        Order History
                    </a>
                </li>
                <li class="account-nav__item">
                    <a href="/html/account/track-order.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                        Track Order
                    </a>
                </li>
                <li class="account-nav__item">
                    <a href="/html/account/printers.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M6 9V2h12v7"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
                        My Printers
                    </a>
                </li>
                <li class="account-nav__divider" aria-hidden="true">Business</li>
                <li class="account-nav__item">
                    <a href="/html/business.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                        Business Accounts
                    </a>
                </li>
                <li class="account-nav__item account-nav__item--admin" id="admin-nav-item" hidden>
                    <a href="/html/admin/index.html">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        Admin Panel
                    </a>
                </li>
                <li class="account-nav__item account-nav__item--logout">
                    <a href="#" class="logout-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                        Logout
                    </a>
                </li>
            </ul>
        </nav>

        <!-- Trust micro-panel -->
        <div class="account-sidebar__trust">
            <div class="account-sidebar__trust-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                100% NZ Owned
            </div>
            <div class="account-sidebar__trust-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                Fast NZ-wide dispatch
            </div>
            <div class="account-sidebar__trust-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
                30-day returns
            </div>
        </div>
    </aside>
                    <div class="account-content">
                        <h1 class="account-content__heading">Account Settings</h1>
                        <form class="account-form">
                            <div class="form-section">
                                <h2>Personal Information</h2>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="first-name" class="form-label">First Name</label>
                                        <input type="text" id="first-name" class="form-input" value="" maxlength="100">
                                    </div>
                                    <div class="form-group">
                                        <label for="last-name" class="form-label">Last Name</label>
                                        <input type="text" id="last-name" class="form-input" value="" maxlength="100">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email" class="form-label">Email Address</label>
                                    <input type="email" id="email" class="form-input" value="" readonly>
                                </div>
                                <div class="form-group">
                                    <label for="phone" class="form-label">Phone Number</label>
                                    <div class="phone-input-group">
                                        <select id="phone-country" class="phone-country-code" aria-label="Country code">
                                            <option value="+64" selected>+64</option>
                                            <option value="+61">+61</option>
                                            <option value="+1">+1</option>
                                            <option value="+44">+44</option>
                                        </select>
                                        <input type="tel" id="phone" class="phone-number" value="" maxlength="20">
                                    </div>
                                </div>
                            </div>
                            <div class="form-section">
                                <h2>Change Password</h2>
                                <div class="form-group">
                                    <label for="current-password" class="form-label">Current Password</label>
                                    <input type="password" id="current-password" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="new-password" class="form-label">New Password</label>
                                    <input type="password" id="new-password" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label for="confirm-password" class="form-label">Confirm New Password</label>
                                    <input type="password" id="confirm-password" class="form-input">
                                </div>
                            </div>
                            <div class="form-section">
                                <h2>Email Preferences</h2>
                                <div class="form-group">
                                    <label class="checkbox">
                                        <input type="checkbox" checked>
                                        <span class="checkbox__label">Order updates and shipping notifications</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox">
                                        <input type="checkbox" checked>
                                        <span class="checkbox__label">Special offers and promotions</span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label class="checkbox">
                                        <input type="checkbox">
                                        <span class="checkbox__label">Product recommendations based on my printers</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn--primary">Save Changes</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <!-- ============================================
         FOOTER
         ============================================ -->
    <footer class="site-footer">
        <div class="footer-main">
            <div class="container">
                <div class="footer-grid">
                    <!-- Brand column -->
                    <div class="footer-brand">
                        <a href="/html/index.html" class="footer-brand__logo">
                            <span class="logo__text">Ink<span>Cartridges</span>.co.nz</span>
                        </a>
                        <p class="footer-brand__description">
                            New Zealand's trusted source for quality printing supplies.
                            We help homes and businesses keep printing with genuine and
                            compatible ink and toner cartridges.
                        </p>
                        <div class="footer-brand__social">
                            <a href="#" aria-label="Facebook">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
                            </a>
                            <a href="#" aria-label="Instagram">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="2" width="20" height="20" rx="5" ry="5"/><path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"/><line x1="17.5" y1="6.5" x2="17.51" y2="6.5"/></svg>
                            </a>
                            <a href="#" aria-label="LinkedIn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
                            </a>
                        </div>
                    </div>

                    <!-- Support column -->
                    <div class="footer-column">
                        <h3 class="footer-column__heading">Support</h3>
                        <ul class="footer-links">
                            <li><a href="/html/contact.html">Contact Us</a></li>
                            <li><a href="/html/faq.html">FAQs</a></li>
                            <li><a href="/html/returns.html">Returns & Refunds</a></li>
                            <li><a href="/html/about.html">About Us</a></li>
                            <li><a href="/html/business.html">Business Accounts</a></li>
                        </ul>
                    </div>

                    <!-- Contact column -->
                    <div class="footer-column">
                        <h3 class="footer-column__heading">Contact</h3>
                        <ul class="footer-links">
                            <li>
                                <strong>Phone:</strong><br>
                                <a href="tel:0800465275">0800 INK KART (465 275)</a>
                            </li>
                            <li>
                                <strong>Email:</strong><br>
                                <a href="mailto:support@inkcartridges.co.nz">support@inkcartridges.co.nz</a>
                            </li>
                            <li>
                                <strong>Hours:</strong><br>
                                8am - 8pm, 7 days a week
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Trust badges -->
                <div class="footer-trust">
                    <div class="footer-trust__item">
                        <svg class="footer-trust__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                        <span>100% NZ Owned</span>
                    </div>
                    <div class="footer-trust__item">
                        <svg class="footer-trust__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        <span>Secure Checkout</span>
                    </div>
                    <div class="footer-trust__item">
                        <svg class="footer-trust__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
                        <span>Fast NZ Delivery</span>
                    </div>
                    <div class="footer-trust__item">
                        <svg class="footer-trust__icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        <span>NZ-Based Support</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <div class="container">
                <p class="footer-copyright">
                    &copy; <span id="current-year">2025</span> InkCartridges.co.nz. All rights reserved.
                </p>
                <div class="footer-legal">
                    <a href="/html/privacy.html">Privacy Policy</a>
                    <a href="/html/terms.html">Terms & Conditions</a>
                </div>
                <div class="footer-payment">
                    <span class="footer-payment__label">We accept:</span>
                    <div class="footer-payment__icons">
                        <span title="Visa">Visa</span>
                        <span title="Mastercard">MC</span>
                        <span title="PayPal">PayPal</span>
                        <span title="Afterpay">Afterpay</span>
                        <span title="POLi">POLi</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/config.js"></script>
    <script src="/js/security.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/mega-nav.js"></script>
    <script src="/js/modern-effects.js"></script>
    <script src="/js/cart.js"></script>
    <script src="/js/printer-data.js"></script>
    <script src="/js/account.js"></script>
    <script>
    // Simple notification function
    function showNotification(message, type = 'info') {
        // Remove any existing notification
        const existing = document.querySelector('.settings-notification');
        if (existing) existing.remove();

        const notification = document.createElement('div');
        notification.className = `settings-notification settings-notification--${type}`;
        notification.innerHTML = `
            <span>${message}</span>
            <button type="button" onclick="this.parentElement.remove()">&times;</button>
        `;
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease;
        `;
        notification.querySelector('button').style.cssText = `
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        `;
        document.body.appendChild(notification);

        // Auto remove after 5 seconds
        setTimeout(() => notification.remove(), 5000);
    }

    const SettingsPage = {
        async init() {
            // Always setup form handlers first
            this.setupFormSubmit();
            this.setupPasswordChange();

            // Wait a moment for AccountPage to initialize auth
            await new Promise(resolve => setTimeout(resolve, 500));

            // Load user data if authenticated
            if (Auth.isAuthenticated()) {
                this.loadUserData();
            }
        },

        // Helper to parse phone with country code
        parsePhoneWithCountry(phone) {
            if (!phone) return { countryCode: '+64', phoneNumber: '' };
            const match = phone.match(/^(\+\d{1,3})\s*(.*)$/);
            if (match) {
                return { countryCode: match[1], phoneNumber: match[2] };
            }
            return { countryCode: '+64', phoneNumber: phone };
        },

        // Helper to set phone fields
        setPhoneFields(phone) {
            const { countryCode, phoneNumber } = this.parsePhoneWithCountry(phone);
            const phoneCountrySelect = document.getElementById('phone-country');
            const phoneInput = document.getElementById('phone');

            if (phoneCountrySelect) {
                const option = phoneCountrySelect.querySelector(`option[value="${countryCode}"]`);
                if (option) phoneCountrySelect.value = countryCode;
            }
            if (phoneInput) phoneInput.value = phoneNumber;
        },

        async loadUserData() {
            // Always start with Auth.user data (guaranteed to exist if authenticated)
            if (Auth.user) {
                const authUser = Auth.user;
                document.getElementById('email').value = authUser.email || '';
                document.getElementById('first-name').value = authUser.user_metadata?.first_name || '';
                document.getElementById('last-name').value = authUser.user_metadata?.last_name || '';
                this.setPhoneFields(authUser.user_metadata?.phone || '');
            }

            // Try to get more complete data from API (non-blocking)
            try {
                const response = await API.getProfile();
                if (response.success && response.data) {
                    const user = response.data;
                    // Update fields with API data
                    if (user.first_name) document.getElementById('first-name').value = user.first_name;
                    if (user.last_name) document.getElementById('last-name').value = user.last_name;
                    if (user.email) document.getElementById('email').value = user.email;
                    if (user.phone) this.setPhoneFields(user.phone);

                    // Load email preferences if available
                    if (user.email_preferences) {
                        const prefs = user.email_preferences;
                        const checkboxes = document.querySelectorAll('.form-section:last-of-type input[type="checkbox"]');
                        if (checkboxes[0]) checkboxes[0].checked = prefs.order_updates !== false;
                        if (checkboxes[1]) checkboxes[1].checked = prefs.promotions !== false;
                        if (checkboxes[2]) checkboxes[2].checked = prefs.recommendations === true;
                    }
                }
            } catch (error) {
                console.log('Could not load profile from API:', error.message);
                // Form still works with Auth.user data
            }
        },

        setupFormSubmit() {
            const form = document.querySelector('.account-form');
            if (!form) return;

            form.addEventListener('submit', async (e) => {
                e.preventDefault();

                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Saving...';
                submitBtn.disabled = true;

                try {
                    // Get form values
                    const firstName = document.getElementById('first-name').value.trim();
                    const lastName = document.getElementById('last-name').value.trim();

                    // Combine country code + phone number
                    const phoneCountry = document.getElementById('phone-country')?.value || '+64';
                    const phoneNumber = document.getElementById('phone').value.trim();
                    const phone = phoneNumber ? `${phoneCountry} ${phoneNumber}` : '';

                    // Get email preferences
                    const checkboxes = document.querySelectorAll('.form-section:last-of-type input[type="checkbox"]');
                    const emailPreferences = {
                        order_updates: checkboxes[0]?.checked ?? true,
                        promotions: checkboxes[1]?.checked ?? true,
                        recommendations: checkboxes[2]?.checked ?? false
                    };

                    // Prepare profile data
                    const profileData = {
                        first_name: firstName,
                        last_name: lastName,
                        phone: phone,
                        email_preferences: emailPreferences
                    };

                    // Try to save to backend API first
                    let backendSuccess = false;
                    try {
                        const response = await API.updateProfile(profileData);
                        if (response.success) {
                            backendSuccess = true;
                        } else {
                            console.warn('Backend API failed:', response.error);
                        }
                    } catch (apiError) {
                        console.warn('Backend API error:', apiError.message);
                    }

                    // Also save to Supabase user metadata (backup/sync)
                    const { error: supabaseError } = await Auth.supabase.auth.updateUser({
                        data: {
                            first_name: firstName,
                            last_name: lastName,
                            phone: phone,
                            full_name: `${firstName} ${lastName}`.trim(),
                            email_preferences: emailPreferences
                        }
                    });

                    if (backendSuccess) {
                        showNotification('Settings saved successfully', 'success');
                    } else if (!supabaseError) {
                        showNotification('Settings saved (sync pending)', 'success');
                    } else {
                        showNotification('Failed to save settings', 'error');
                    }

                    // Update sidebar name display
                    const nameEl = document.getElementById('user-name');
                    if (nameEl) nameEl.textContent = `${firstName} ${lastName}`.trim();
                } catch (error) {
                    console.error('Failed to save settings:', error);
                    showNotification('Failed to save settings', 'error');
                } finally {
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            });
        },

        setupPasswordChange() {
            const currentPassword = document.getElementById('current-password');
            const newPassword = document.getElementById('new-password');
            const confirmPassword = document.getElementById('confirm-password');

            // Add password change validation on form submit
            const form = document.querySelector('.account-form');
            if (!form) return;

            const originalSubmit = form.onsubmit;

            form.addEventListener('submit', async (e) => {
                // Only handle password change if fields are filled
                if (newPassword.value || currentPassword.value) {
                    if (!currentPassword.value) {
                        showNotification('Please enter your current password', 'error');
                        e.preventDefault();
                        return;
                    }
                    if (newPassword.value !== confirmPassword.value) {
                        showNotification('New passwords do not match', 'error');
                        e.preventDefault();
                        return;
                    }
                    if (newPassword.value.length < 8) {
                        showNotification('New password must be at least 8 characters', 'error');
                        e.preventDefault();
                        return;
                    }

                    try {
                        const result = await Auth.updatePassword(newPassword.value);
                        if (result.success) {
                            showNotification('Password updated successfully', 'success');
                            currentPassword.value = '';
                            newPassword.value = '';
                            confirmPassword.value = '';
                        } else {
                            showNotification(result.error || 'Failed to update password', 'error');
                        }
                    } catch (error) {
                        showNotification('Failed to update password', 'error');
                    }
                }
            });
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        SettingsPage.init();
    });
    </script>
    <script src="/js/analytics.js"></script>
</body>
</html>